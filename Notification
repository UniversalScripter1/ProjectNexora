local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local notif = {}
local active_notifications = {}
local SPACING = 70 -- Pixels between notifications

-- Function to shift existing notifications upward
local function shiftNotifications()
    for i, frame in ipairs(active_notifications) do
        local targetPos = UDim2.new(1, -340, 0.8, -(#active_notifications - i + 1) * SPACING)
        TweenService:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
            Position = targetPos
        }):Play()
    end
end

function notif:Notification(title, desc, font, font2, visibletime)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "Notification_" .. title
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = CoreGui

    local main = Instance.new("Frame")
    main.Name = "Main"
    main.BackgroundColor3 = Color3.fromRGB(17, 17, 17)
    main.BorderSizePixel = 0
    main.Position = UDim2.new(1, 10, 0.8, 0) -- Start off-screen right
    main.Size = UDim2.new(0, 331, 0, 61)
    main.Parent = screenGui

    local bar = Instance.new("Frame")
    bar.Name = "Bar"
    bar.BackgroundColor3 = Color3.fromRGB(11, 11, 11)
    bar.Size = UDim2.new(0, 11, 1, 0)
    bar.Parent = main

    local barCorner = Instance.new("UICorner")
    barCorner.CornerRadius = UDim.new(0, 10)
    barCorner.Parent = bar

    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 7)
    mainCorner.Parent = main

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Font = Enum.Font[font or "GothamBold"]
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextSize = 14
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0.08, 0, 0.1, 0)
    titleLabel.Size = UDim2.new(0, 201, 0, 25)
    titleLabel.Parent = main

    local descLabel = Instance.new("TextLabel")
    descLabel.Name = "Description"
    descLabel.Font = Enum.Font[font2 or "Gotham"]
    descLabel.Text = desc
    descLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    descLabel.TextSize = 13
    descLabel.TextTruncate = Enum.TextTruncate.AtEnd
    descLabel.TextXAlignment = Enum.TextXAlignment.Left
    descLabel.BackgroundTransparency = 1
    descLabel.Position = UDim2.new(0.08, 0, 0.5, 0)
    descLabel.Size = UDim2.new(0, 250, 0, 25)
    descLabel.Parent = main

    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "Close"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Text = "Ã—"
    closeBtn.TextColor3 = Color3.new(1, 1, 1)
    closeBtn.TextSize = 20
    closeBtn.BackgroundTransparency = 1
    closeBtn.Position = UDim2.new(0.9, 0, 0, 0)
    closeBtn.Size = UDim2.new(0, 30, 1, 0)
    closeBtn.Parent = main

    -- Management logic
    shiftNotifications()
    table.insert(active_notifications, main)

    -- Entrance Tween (Slide In)
    local entryTween = TweenService:Create(main, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -340, 0.8, 0)
    })
    entryTween:Play()

    local function dismiss()
        if not main or not main.Parent then return end
        
        -- Remove from active list
        for i, v in ipairs(active_notifications) do
            if v == main then
                table.remove(active_notifications, i)
                break
            end
        end

        -- Exit Tween (Fade and Slide Up)
        local exitTween = TweenService:Create(main, TweenInfo.new(0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.In), {
            Position = main.Position + UDim2.new(0, 0, 0, -50),
            BackgroundTransparency = 1
        })
        
        -- Fade children
        for _, child in ipairs(main:GetDescendants()) do
            if child:IsA("TextLabel") or child:IsA("TextButton") then
                TweenService:Create(child, TweenInfo.new(0.4), {TextTransparency = 1}):Play()
            elseif child:IsA("Frame") then
                TweenService:Create(child, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
            end
        end

        exitTween:Play()
        exitTween.Completed:Connect(function()
            screenGui:Destroy()
        end)
    end

    closeBtn.MouseButton1Click:Connect(dismiss)

    task.delay(visibletime or 5, function()
        dismiss()
    end)
end

return notif
